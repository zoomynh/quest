<!doctype html>
<html lang="uk">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>Авторизація — СБУ</title>
    <link rel="stylesheet" href="style.css" />
    <script src="https://cdn.jsdelivr.net/npm/tesseract.js@5/dist/tesseract.min.js"></script>
  </head>
  <body class="login-body">
    <div class="login-box">
      <h1>Служба Безпеки України</h1>
      <p class="login-sub">Завантажте зображення пропуску</p>

      <input type="file" id="passFile" accept="image/*" />
      <button class="btn" onclick="authorize()">Сканувати та увійти</button>

      <p id="status" class="login-status"></p>
    </div>

    <script>
      async function authorize() {
        const file = document.getElementById("passFile").files[0];
        const status = document.getElementById("status");

        if (!file) {
          status.textContent = "Завантажте зображення пропуску";
          status.className = "login-status err";
          return;
        }

        status.textContent = "Сканування…";
        status.className = "login-status";

        try {
          const {
            data: { text },
          } = await Tesseract.recognize(file, "ukr+eng");
          const normalized = (text || "").toLowerCase();

          if (normalized.includes("служба безпеки україни")) {
            localStorage.setItem("accessGranted", "true");
            window.location.href = "index.html";
          } else {
            status.textContent = "Доступ заборонено";
            status.className = "login-status err";
          }
        } catch (e) {
          status.textContent = "Помилка сканування";
          status.className = "login-status err";
        }
      }
    </script>
  </body>
</html>
